<!DOCTYPE html>
<html>
<head>
        <title>Loudoun County Rural Water Supply</title>
        <meta charset="utf-8" />

        <meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.6.4/leaflet.css" />
<!--[if lte IE 8]>
    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.6.4/leaflet.ie.css" />
<![endif]-->

<script src="http://cdn.leafletjs.com/leaflet-0.6.4/leaflet.js"></script>
</head>
<body>
        <div id="map" style="width: 800px; height: 600px"></div>

        <script src="sources.geojson"></script>
        <script>
                var map = L.map('map').setView([ 39.12, -77.65], 16);
                
                //var baseLayer = L.tileLayer('https://{s}.tiles.mapbox.com/v3/jasondalton.map-7z4qef6u/{z}/{x}/{y}.png', {
                var baseLayer = L.tileLayer('http://{s}.tile.cloudmade.com/{key}/22677/256/{z}/{x}/{y}.png', {
                        attribution: 'Azimuth1',
                        maxZoom: 22
                });

                baseLayer.addTo(map);

                var baseballIcon = L.icon({
                        iconUrl: 'baseball-marker.png',
                        iconSize: [32, 37],
                        iconAnchor: [16, 37],
                        popupAnchor: [0, -28]
                });

                function onEachFeature(feature, layer) {
                        var popupContent = "<p></p>";

                        if (feature.properties && feature.properties.popupContent) {
                                popupContent += feature.properties.popupContent;
                        }

                        layer.bindPopup(popupContent);
                }

                L.geoJson([sources], {

                        style: function (feature) {
                                return feature.properties && feature.properties.style;
                        },

                        onEachFeature: onEachFeature,

                        pointToLayer: function (feature, latlng) {
                                return L.circleMarker(latlng, {
                                        radius: 8,
                                        fillColor: "#ff7800",
                                        color: "#000",
                                        weight: 1,
                                        opacity: 1,
                                        fillOpacity: 0.8
                                });
                        }
                }).addTo(map);

		function getRoute(response) {
                	var point, route, points = [];
                	for (var i=0; i<response.route_geometry.length; i++) {
                    		point = new L.LatLng(response.route_geometry[i][0] , response.route_geometry[i][1]);
                    		points.push(point);
                	}
                	route= new L.Polyline(points, {
                    		weight: 3,
                    		opacity: 0.5,
                    		smoothFactor: 1
                	}).addTo(map);
                	route.bringToFront();
            	}
            	
		function addScript(url) {
			var script = document.createElement('script');
			script.type="text/javascript";
			script.src=url;
			document.getElementsByTagName('head') [0].appendChild(script);
		}


		fromMarker = new L.Marker(new L.latLng([12.999070,77.568679])).addTo(map);
		toMarker=new L.Marker(new L.latLng([13.006610,77.578130])).addTo(map);
		addScript('http://routes.cloudmade.com/0e0491f21622495da28cf15c92bf9419/api/0.3/' + fromMarker.getLatLng().lat + ',' + fromMarker.getLatLng().lng + ',' + toMarker.getLatLng().lat + ',' + toMarker.getLatLng().lng + '/car.js?callback=getRoute');

        </script>
</body>
</html>


